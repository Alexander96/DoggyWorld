div.chat-window(ng-repeat="discussion in discussions" ng-controller="ChatController" ng-init="discussion.allowSend = true;") 
	div.chat-window-header(ng-drag="true" ng-drag-success="onDragComplete($event)" 
	no-reset="true"  use-parent="true") {{discussion.recipient.firstName}}
	div.chat-window-close(ng-click="closeDiscussion(discussion)") X
	div.chat-window-content(ng-init="getMessages(discussion.recipient._id)" scroll-glue="true")
		div.message(ng-repeat="message in discussion.messages track by $index")
			div.message-date(ng-show="message.firstOfQuery") {{message.date | moment: 'fromNow'}} 
			div.message-content(ng-class="{'message-alt': message.to == discussion.recipient._id}") {{message.content}}
			div.message-seen(ng-show="message.seen && $last && message.from != discussion.recipient._id") Seen
	div.chat-footer
		textarea.chat-text-input(type="text" ng-model="discussion.messageContent" 
		ng-keydown="trySendMessage(discussion.recipient._id, discussion.messageContent, $event, discussion)" ng-keyup="allowSendMaybe($event, discussion)" ng-focus="seeMessages(discussion)" ng-blur="discussion.seeNewMessage = false;" ng-change="handleTyping(discussion)")
		button.chat-submit-btn(ng-click="sendMessage(discussion.recipient._id, discussion.messageContent)") Send